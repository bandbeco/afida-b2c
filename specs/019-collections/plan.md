# Implementation Plan: Collections & Curated Sample Packs

**Branch**: `019-collections` | **Date**: 2026-01-17 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/019-collections/spec.md`

## Summary

Enable audience-based product navigation through Collections (cross-cutting product groups like "Coffee Shop Essentials") and Curated Sample Packs (pre-selected samples for specific customer types). Collections slice horizontally by audience/use-case, unlike Categories which slice vertically by product type. A product belongs to ONE category but can appear in MANY collections.

## Technical Context

**Language/Version**: Ruby 3.4.7 / Rails 8.1.1
**Primary Dependencies**: Hotwire (Turbo + Stimulus), TailwindCSS 4 + DaisyUI, acts_as_list, Active Storage
**Storage**: PostgreSQL (existing database)
**Testing**: Minitest (fixtures-based, per CLAUDE.md)
**Target Platform**: Web application (existing Rails monolith)
**Project Type**: Rails monolith with Vite frontend
**Performance Goals**: Standard page load times, sample pack add completes in <2 seconds
**Constraints**: Must integrate with existing samples flow (5-sample limit), follow existing admin patterns
**Scale/Scope**: Existing e-commerce site, ~100 products, ~10 categories

## Constitution Check

*No violations - follows existing patterns:*
- Uses existing model patterns (like Category, Product)
- Follows existing admin CRUD patterns
- Leverages existing samples flow
- No new external dependencies beyond existing stack

## Project Structure

### Documentation (this feature)

```text
specs/019-collections/
├── spec.md              # Feature specification
├── plan.md              # This file
├── checklists/          # Quality checklists
│   └── requirements.md  # Spec validation
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
app/
├── controllers/
│   ├── collections_controller.rb      # Public collection pages
│   ├── samples_controller.rb          # Modified for sample packs
│   └── admin/
│       └── collections_controller.rb  # Admin CRUD
├── models/
│   ├── collection.rb                  # Collection model
│   └── collection_item.rb             # Join table model
├── views/
│   ├── collections/
│   │   ├── index.html.erb
│   │   ├── show.html.erb
│   │   └── _card.html.erb
│   ├── samples/
│   │   └── pack.html.erb              # Sample pack page
│   └── admin/
│       └── collections/
│           ├── index.html.erb
│           ├── new.html.erb
│           ├── edit.html.erb
│           ├── order.html.erb
│           ├── _form.html.erb
│           └── _product_selector.html.erb
└── helpers/
    └── collections_helper.rb

db/
└── migrate/
    ├── XXXXXX_create_collections.rb
    └── XXXXXX_create_collection_items.rb

test/
├── models/
│   ├── collection_test.rb
│   └── collection_item_test.rb
├── controllers/
│   ├── collections_controller_test.rb
│   └── admin/
│       └── collections_controller_test.rb
├── fixtures/
│   ├── collections.yml
│   └── collection_items.yml
└── system/
    └── collections_test.rb

config/
└── routes.rb                          # Add collection routes
```

**Structure Decision**: Standard Rails structure following existing patterns. Collections controller mirrors Categories controller. Admin collections controller mirrors Admin::CategoriesController.

## Key Entities

### Collection

| Attribute | Type | Notes |
|-----------|------|-------|
| name | string | Required |
| slug | string | Required, unique, for URLs |
| description | text | Optional |
| meta_title | string | SEO |
| meta_description | text | SEO |
| featured | boolean | Show on /collections index |
| sample_pack | boolean | Show on /samples instead |
| position | integer | Ordering via acts_as_list |
| image | attachment | Active Storage |

### CollectionItem (Join Table)

| Attribute | Type | Notes |
|-----------|------|-------|
| collection_id | FK | Required |
| product_id | FK | Required |
| position | integer | Order within collection |

**Constraints**: Unique on (collection_id, product_id)

## Integration Points

1. **Product Model**: Add `has_many :collection_items` and `has_many :collections, through: :collection_items`
2. **Samples Flow**: Sample packs use existing cart integration with `is_sample: true` flag
3. **Navigation**: Add Collections link to site nav and admin sidebar
4. **SEO**: Follow existing Category pattern for structured data

## Complexity Tracking

*No violations to track - feature follows all existing patterns.*
