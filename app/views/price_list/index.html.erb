<% content_for :title, "Price List | Afida" %>
<% content_for :meta_description, "Complete price list for Afida eco-friendly packaging supplies. Filter by category or search. Export to Excel or PDF." %>

<div class="drawer drawer-end" data-controller="cart-drawer">
  <input id="cart-drawer" type="checkbox" class="drawer-toggle" data-cart-drawer-target="checkbox" aria-label="Toggle shopping cart" />

  <div class="drawer-content">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
        <div>
          <h1>Price List</h1>
          <p class="text-gray-600 mt-1">All prices exclude VAT. Free UK delivery on orders over Â£100.</p>
        </div>
        <div class="flex gap-3 mt-4 md:mt-0">
          <%= link_to price_list_export_path(request.query_parameters.merge(format: :xlsx)),
              class: "btn btn-outline btn-sm flex items-center gap-1", data: { turbo: false } do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Excel
          <% end %>
          <%= link_to price_list_export_path(request.query_parameters.merge(format: :pdf)),
              class: "btn btn-outline btn-sm flex items-center gap-1", data: { turbo: false } do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            PDF
          <% end %>
        </div>
      </div>

      <!-- Filter Bar -->
      <%= form_with url: price_list_path, method: :get, data: { controller: "form", turbo_frame: "price_list_table" } do %>
        <div class="flex flex-wrap gap-3 mb-6 items-end">
          <div class="form-control w-full md:w-48">
            <%= select_tag :category,
                options_for_select([["All Categories", ""]] + @categories.map { |c| [c.name, c.slug] }, params[:category]),
                class: "select select-bordered select-sm w-full",
                "aria-label": "Filter by category",
                data: { action: "change->form#submit" } %>
          </div>

          <div class="form-control flex-1 min-w-[200px]">
            <%= text_field_tag :q, params[:q],
                placeholder: "Search products...",
                class: "input input-bordered input-sm w-full",
                "aria-label": "Search products by name or SKU",
                data: { controller: "search", action: "input->search#debounce" } %>
          </div>

          <% if params[:category].present? || params[:q].present? %>
            <%= link_to "Clear", price_list_path, class: "btn btn-ghost btn-sm" %>
          <% end %>
        </div>
      <% end %>

      <!-- Table -->
      <%= turbo_frame_tag "price_list_table" do %>
        <%= render "table", products: @products %>
      <% end %>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div class="drawer-side z-50">
    <label for="cart-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <div class="bg-base-200 w-80 min-h-full p-4">
      <%= render "shared/drawer_cart_content" %>
    </div>
  </div>
</div>
