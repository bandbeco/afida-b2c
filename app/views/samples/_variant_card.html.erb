<%# Individual variant card for sample selection %>
<%
  in_cart ||= false
  at_limit ||= false
  error ||= nil

  # Find cart item if in cart (for remove button)
  cart_item = Current.cart&.cart_items&.find_by(product_variant: variant) if in_cart
%>

<%= turbo_frame_tag dom_id(variant, :sample) do %>
  <div class="card bg-base-100 border <%= error ? 'border-error' : 'border-base-200' %> hover:shadow-md transition-shadow">
    <!-- Product Image -->
    <figure class="px-4 pt-4">
      <% photo = variant.primary_photo || variant.product.primary_photo %>
      <% if photo %>
        <%= image_tag photo.variant(resize_to_fill: [200, 200]),
                      class: "rounded-lg w-full h-32 object-cover",
                      alt: variant.display_name %>
      <% else %>
        <div class="w-full h-32 bg-base-200 rounded-lg flex items-center justify-center">
          <span class="text-4xl">ðŸ“¦</span>
        </div>
      <% end %>
    </figure>

    <div class="card-body p-4">
      <!-- Product Name -->
      <h3 class="font-medium text-sm line-clamp-2" title="<%= variant.display_name %>">
        <%= variant.product.name %>
      </h3>

      <!-- Variant Info -->
      <p class="text-xs text-base-content/70">
        <%= variant.name %>
      </p>

      <% if error %>
        <!-- Error Message -->
        <p class="text-xs text-error mt-1"><%= error %></p>
      <% end %>

      <!-- Action Button -->
      <div class="card-actions justify-center mt-2">
        <% if in_cart %>
          <%# Already in cart - show "Added" with remove option %>
          <%= button_to cart_cart_item_path(cart_item),
                        method: :delete,
                        class: "btn btn-success btn-sm w-full gap-2",
                        data: { turbo_frame: dom_id(variant, :sample) } do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Added
          <% end %>
        <% elsif at_limit %>
          <%# At sample limit - disabled button %>
          <button class="btn btn-disabled btn-sm w-full" disabled>
            Limit Reached
          </button>
        <% else %>
          <%# Can add sample %>
          <%= button_to cart_cart_items_path,
                        class: "btn btn-primary btn-outline btn-sm w-full",
                        params: { product_variant_id: variant.id, sample: true },
                        data: { turbo_frame: dom_id(variant, :sample) } do %>
            Add Sample
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
