<%= turbo_stream.replace "redirect_#{@redirect.id}" do %>
  <tr id="redirect_<%= @redirect.id %>">
    <td class="font-mono text-sm"><%= @redirect.source_path %></td>
    <td>
      <%= @product&.name || @redirect.target_slug %>
    </td>
    <td>
      <% variant = find_matching_variant(@product, @redirect.variant_params) %>
      <% if variant %>
        <div class="text-sm">
          <div><%= variant.name %></div>
          <div class="text-xs text-gray-500">SKU: <%= variant.sku %></div>
        </div>
      <% elsif @redirect.variant_params.present? %>
        <span class="text-xs text-warning">⚠️ No matching variant</span>
      <% else %>
        <span class="text-xs text-gray-400">—</span>
      <% end %>
    </td>
    <td><%= @redirect.hit_count %></td>
    <td>
      <%= form_with model: @redirect, url: toggle_admin_url_redirect_path(@redirect), method: :patch, data: { turbo_frame: "_top" } do |f| %>
        <label class="label cursor-pointer justify-start gap-2">
          <input
            type="checkbox"
            class="toggle toggle-success"
            <%= "checked" if @redirect.active? %>
            onchange="this.form.requestSubmit()"
          />
          <span class="label-text text-xs">
            <%= @redirect.active? ? "Active" : "Inactive" %>
          </span>
        </label>
      <% end %>
    </td>
    <td>
      <div class="flex gap-1">
        <%= link_to "View", admin_url_redirect_path(@redirect), class: "btn btn-xs btn-ghost" %>
        <%= link_to "Edit", edit_admin_url_redirect_path(@redirect), class: "btn btn-xs btn-ghost" %>
        <%= button_to "Delete", admin_url_redirect_path(@redirect), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-xs btn-error" %>
      </div>
    </td>
  </tr>
<% end %>

<%= turbo_stream.prepend "flash" do %>
  <div class="alert alert-success" data-turbo-temporary>
    <%= flash[:notice] %>
  </div>
<% end %>
