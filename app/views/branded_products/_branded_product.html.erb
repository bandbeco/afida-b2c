<% image_index ||= 999 %> <%# Default if index not provided %>
<div class="card shadow-sm bg-base-100"
     data-controller="product-card-hover"
     data-action="mouseenter->product-card-hover#mouseenter mouseleave->product-card-hover#mouseleave">
  <figure class="relative max-w-[600px] max-h-[600px] bg-white">
    <span class="badge bg-white text-black border-black absolute top-2 right-2 z-10 text-xs">Volume discount</span>
    <%= link_to branded_product_path(product), class: "w-full h-full" do %>
      <div class="product-image-container">
        <% if product.product_photo&.attached? %>
          <%= image_tag product.product_photo.variant(resize_and_pad: [400, 400, { background: [255, 255, 255] }]),
                        alt: product.generated_title,
                        class: "product-image object-contain",
                        width: 400,
                        height: 400,
                        **(image_index == 0 ? { fetchpriority: "high" } : {}),
                        data: { product_card_hover_target: "productPhoto" } %>
        <% end %>

        <% if product.lifestyle_photo&.attached? %>
          <%= image_tag product.lifestyle_photo.variant(resize_and_pad: [400, 400, { background: [255, 255, 255] }]),
                        alt: "#{product.generated_title} lifestyle",
                        class: "product-image product-image-overlay object-contain",
                        width: 400,
                        height: 400,
                        data: { product_card_hover_target: "lifestylePhoto" } %>
        <% end %>

        <% unless product.product_photo&.attached? || product.lifestyle_photo&.attached? %>
          <div class="w-full h-[400px] lg:h-[400px] bg-gray-200 shadow-md flex items-center justify-center">
            <span class="text-gray-700">Image not available</span>
          </div>
        <% end %>
      </div>
    <% end %>
  </figure>
  <div class="card-body text-center">
    <h3 class="justify-center">
      <%= link_to branded_product_path(product) do %>
        <%= product.generated_title %>
      <% end %>
    </h3>

    <% if product.description_short_with_fallback.present? %>
      <p class="text-sm text-gray-600 mt-2"><%= product.description_short_with_fallback %></p>
    <% end %>

    <% if product.featured? %>
      <div class="badge badge-secondary absolute top-2 right-2 z-10">BESTSELLER</div>
    <% end %>
  </div>
</div>