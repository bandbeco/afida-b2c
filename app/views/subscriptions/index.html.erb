<div class="container mx-auto px-4 py-8">
  <div class="max-w-6xl mx-auto">

    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Your Subscriptions</h1>
      <p class="mt-2 text-gray-600">Manage your recurring orders</p>
    </div>

    <% if @subscriptions.any? %>
      <div class="space-y-6">
        <% @subscriptions.each do |subscription| %>
          <article class="bg-white shadow-lg rounded-lg overflow-hidden" aria-label="Subscription <%= subscription.stripe_subscription_id %>">
            <div class="px-6 py-4 bg-gray-50 border-b flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold text-gray-900"><%= subscription.frequency_display %> Delivery</h3>
                <p class="text-sm text-gray-600">
                  <% if subscription.active? && subscription.next_billing_date %>
                    Next delivery: <%= subscription.next_billing_date.strftime("%B %d, %Y") %>
                  <% elsif subscription.paused? %>
                    Paused
                  <% elsif subscription.cancelled? %>
                    Cancelled on <%= subscription.cancelled_at&.strftime("%B %d, %Y") %>
                  <% end %>
                </p>
              </div>

              <div class="text-right">
                <span class="inline-flex px-3 py-1 text-sm font-medium rounded-full
                  <% case subscription.status %>
                  <% when 'active' %>
                    bg-green-100 text-green-800
                  <% when 'paused' %>
                    bg-yellow-100 text-yellow-800
                  <% when 'cancelled' %>
                    bg-red-100 text-red-800
                  <% end %>">
                  <%= subscription.status.humanize %>
                </span>
              </div>
            </div>

            <div class="p-6">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <p class="text-sm text-gray-600 mb-4">
                    <%= pluralize(subscription.items.size, 'item') %> • Total: <%= number_to_currency(subscription.total_amount, unit: "£") %>
                  </p>

                  <ul class="text-sm text-gray-700 space-y-1 mb-4">
                    <% subscription.items.each do |item| %>
                      <li>
                        <%= item["product_name"] %> × <%= item["quantity"] %>
                      </li>
                    <% end %>
                  </ul>

                  <% shipping = subscription.parsed_shipping_snapshot %>
                  <p class="text-sm text-gray-600">
                    <strong>Ship to:</strong> <%= shipping["name"] %>, <%= shipping["city"] %>
                  </p>
                </div>

                <div class="ml-6 flex flex-col gap-2">
                  <% if subscription.active? %>
                    <%= button_to "Pause", pause_subscription_path(subscription),
                        method: :patch,
                        class: "inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
                        data: { turbo_confirm: "Are you sure you want to pause this subscription?" } %>
                    <%= button_to "Cancel", subscription_path(subscription),
                        method: :delete,
                        class: "inline-flex items-center justify-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",
                        data: { turbo_confirm: "Are you sure you want to cancel this subscription? This action cannot be undone." } %>
                  <% elsif subscription.paused? %>
                    <%= button_to "Resume", resume_subscription_path(subscription),
                        method: :patch,
                        class: "inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",
                        data: { turbo_confirm: "Resume your subscription?" } %>
                    <%= button_to "Cancel", subscription_path(subscription),
                        method: :delete,
                        class: "inline-flex items-center justify-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",
                        data: { turbo_confirm: "Are you sure you want to cancel this subscription? This action cannot be undone." } %>
                  <% else %>
                    <span class="text-sm text-gray-500 italic">No actions available</span>
                  <% end %>
                </div>
              </div>
            </div>
          </article>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No subscriptions yet</h3>
        <p class="mt-1 text-sm text-gray-500">Subscribe to products for recurring deliveries.</p>
        <div class="mt-6">
          <%= link_to shop_path, class: "btn btn-primary btn-xl shadow-lg shadow-black/20" do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
            Start Shopping
          <% end %>
        </div>
      </div>
    <% end %>

  </div>
</div>
