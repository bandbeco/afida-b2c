<h1 style="font-size: 24px; font-weight: 600; color: #111827; margin: 0 0 15px 0;">Your Reorder is Ready!</h1>

<p style="color: #374151; font-size: 16px; margin: 0 0 20px 0;">
  Hi <%= @user.email_address.split('@').first %>,
  <br><br>
  Your scheduled order is ready for delivery on <strong><%= @pending_order.scheduled_for.strftime("%B %d, %Y") %></strong>.
</p>

<% if @pending_order.unavailable_items.any? %>
  <table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; margin-bottom: 20px;">
    <tr>
      <td style="padding: 15px;">
        <p style="color: #92400e; font-weight: 600; margin: 0 0 10px 0;">Some items are no longer available:</p>
        <ul style="margin: 0; padding-left: 20px; color: #92400e;">
          <% @pending_order.unavailable_items.each do |item| %>
            <li><%= item["product_name"] %> - <%= item["variant_name"] %> (<%= item["reason"] %>)</li>
          <% end %>
        </ul>
        <p style="color: #92400e; margin: 10px 0 0 0; font-size: 14px;">These items have been removed from your order.</p>
      </td>
    </tr>
  </table>
<% end %>

<h2 style="font-size: 18px; font-weight: 600; color: #111827; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin: 20px 0 15px 0;">Order Summary</h2>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
  <% @pending_order.items.each do |item| %>
    <tr>
      <td style="padding-bottom: 12px;">
        <p style="font-size: 15px; color: #111827; margin: 0; font-weight: 600;"><%= item["product_name"] %></p>
        <p style="font-size: 13px; color: #6b7280; margin: 2px 0 0 0;"><%= item["variant_name"] %> &times; <%= item["quantity"] %></p>
      </td>
      <td align="right" style="padding-bottom: 12px;">
        <p style="font-size: 15px; color: #111827; margin: 0;">&pound;<%= item["line_total"] %></p>
      </td>
    </tr>
  <% end %>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="border-top: 2px solid #e5e7eb; margin-top: 10px; padding-top: 15px;">
  <tr>
    <td><p style="font-size: 14px; color: #374151; margin: 0;">Subtotal</p></td>
    <td align="right"><p style="font-size: 14px; color: #111827; margin: 0;">&pound;<%= @pending_order.items_snapshot["subtotal"] %></p></td>
  </tr>
  <tr>
    <td style="padding-top: 5px;"><p style="font-size: 14px; color: #374151; margin: 0;">VAT (20%)</p></td>
    <td align="right" style="padding-top: 5px;"><p style="font-size: 14px; color: #111827; margin: 0;">&pound;<%= @pending_order.items_snapshot["vat"] %></p></td>
  </tr>
  <tr>
    <td style="padding-top: 5px;"><p style="font-size: 14px; color: #374151; margin: 0;">Shipping</p></td>
    <td align="right" style="padding-top: 5px;"><p style="font-size: 14px; color: #111827; margin: 0;">&pound;<%= @pending_order.items_snapshot["shipping"] %></p></td>
  </tr>
  <tr>
    <td style="padding-top: 12px;"><p style="font-size: 16px; color: #111827; margin: 0; font-weight: 600;">Total</p></td>
    <td align="right" style="padding-top: 12px;"><p style="font-size: 16px; color: #111827; margin: 0; font-weight: 600;">&pound;<%= @pending_order.items_snapshot["total"] %></p></td>
  </tr>
</table>

<p style="text-align: center; margin: 25px 0 10px 0;">
  <a href="<%= @review_url %>" target="_blank" style="display: inline-block; background-color: #76e9bf; color: #000000; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: 500;">
    Review &amp; Confirm Order
  </a>
</p>

<p style="text-align: center; margin: 0 0 25px 0;">
  <a href="<%= @edit_url %>" target="_blank" style="display: inline-block; background-color: #e5e7eb; color: #374151; padding: 10px 25px; border-radius: 8px; text-decoration: none; font-weight: 500; font-size: 14px;">
    Edit Order
  </a>
</p>

<p style="text-align: center; color: #6b7280; font-size: 13px; margin: 0;">
  This order is part of your <%= @schedule.frequency.humanize.downcase %> reorder schedule.
</p>
