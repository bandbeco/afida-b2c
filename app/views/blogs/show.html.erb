<% content_for :title, @page_title %>
<% content_for :meta_description, @meta_description %>

<% content_for :head do %>
  <%= canonical_url blog_url(@content_item) %>
  <script type="application/ld+json">
    <%= article_structured_data(@content_item) %>
  </script>
<% end %>

<article class="max-w-4xl mx-auto">
  <header class="mb-8">
    <h1 class="text-4xl md:text-5xl font-bold mb-4"><%= @content_item.title %></h1>

    <div class="flex items-center text-sm text-gray-600 mb-6">
      <span class="font-medium">Afida Editorial Team</span>
      <span class="mx-2">•</span>
      <time datetime="<%= @content_item.published_at.iso8601 %>">
        <%= @content_item.published_at.strftime("%B %d, %Y") %>
      </time>
    </div>

    <% if @content_item.header_image_url.present? %>
      <figure class="mb-8 rounded-lg overflow-hidden">
        <%= image_tag @content_item.header_image_url,
                      alt: @content_item.title,
                      class: "w-full h-auto object-cover" %>
      </figure>
    <% end %>
  </header>

  <div class="prose prose-lg max-w-none mb-12">
    <%= render_markdown(@content_item.body) %>
  </div>

  <% if @related_products.any? %>
    <section class="mt-12 pt-8 border-t border-gray-200">
      <h2 class="text-2xl font-bold mb-6">Related Products</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% @related_products.each do |product| %>
          <div class="card bg-base-100 shadow-sm hover:shadow-md transition">
            <%= link_to product_path(product.slug), data: { turbo_frame: "_top" } do %>
              <figure class="aspect-square">
                <%= product_photo_tag(product.primary_photo,
                                      alt: product.name,
                                      class: "w-full h-full object-cover",
                                      variant: { resize_to_limit: [400, 400] },
                                      loading: "lazy") %>
              </figure>

              <div class="card-body p-4">
                <h3 class="card-title text-lg"><%= product.name %></h3>

                <% if product.description_short_with_fallback.present? %>
                  <p class="text-sm text-gray-600 mb-2"><%= product.description_short_with_fallback %></p>
                <% end %>

                <% price_range = product.price_range %>
                <% price_unit = product.customizable_template? ? "unit" : "pack" %>
                <% if price_range.is_a?(Array) %>
                  <p class="text-sm text-gray-600">from <%= number_to_currency(price_range[0], unit: "£") %> / <%= price_unit %></p>
                <% elsif price_range %>
                  <p class="text-sm text-gray-600">from <%= number_to_currency(price_range, unit: "£") %> / <%= price_unit %></p>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <div class="mt-8 text-center">
    <%= link_to "← Back to Blog", blogs_path, class: "btn btn-outline btn-sm" %>
  </div>
</article>
