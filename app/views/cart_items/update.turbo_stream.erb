<%= turbo_stream.replace "cart_counter", partial: "shared/cart_counter" %>

<%# Update unit price display (for branded products where price changes with quantity) %>
<%= turbo_stream.update "cart_item_#{@cart_item.id}_price" do %>
  <%= format_price_display(@cart_item) %>
<% end %>

<%= turbo_stream.update "cart_item_#{@cart_item.id}_price_mobile" do %>
  <%= format_price_display(@cart_item) %>
<% end %>

<%# Update line totals %>
<%= turbo_stream.update "cart_item_#{@cart_item.id}_total" do %>
  <%= number_to_currency(@cart_item.line_total) %>
<% end %>

<%= turbo_stream.update "cart_item_#{@cart_item.id}_total_mobile" do %>
  <%= number_to_currency(@cart_item.line_total) %>
<% end %>

<%= turbo_stream.update "vat" do %>
  <%= number_to_currency(Current.cart.vat_amount) %>
<% end %>

<%= turbo_stream.update "subtotal" do %>
  <%= number_to_currency(Current.cart.subtotal_amount) %>
<% end %>

<%= turbo_stream.update "grand_total" do %>
  <%= number_to_currency(Current.cart.total_amount) %>
<% end %>

<%# Update discount savings if a discount is active %>
<% if session[:discount_code].present? && Current.cart.subtotal_amount.positive? %>
  <%= turbo_stream.update "discount_savings" do %>
    <%= number_to_currency(Current.cart.subtotal_amount * 0.05, unit: "Â£") %>
  <% end %>
<% end %>