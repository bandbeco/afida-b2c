<%= turbo_frame_tag cart_item do %>
  <%
    # Branded products use different path
    # Standard products link directly to their product page
    if cart_item.configured?
      product_url = branded_product_path(cart_item.product)
    else
      product_url = product_path(cart_item.product)
    end
  %>
  <div class="grid grid-cols-1 md:grid-cols-6 gap-2 md:gap-4 items-center p-3 sm:p-4 border-b hover:bg-gray-50 text-center md:text-left">
    <div class="col-span-full md:col-span-2 flex flex-row items-center gap-3 md:space-x-4">
      <%= link_to product_url, "aria-label": "View #{cart_item.product.generated_title} details", data: { turbo: false }, class: "relative flex-shrink-0" do %>
        <%= product_photo_tag(cart_item.product.primary_photo, alt: cart_item.product.generated_title, class: "w-16 h-16 sm:w-20 sm:h-20 rounded-md shadow bg-white object-contain") %>
        <% if cart_item.sample? %>
          <%= render "shared/sample_badge", size: :md %>
        <% end %>
      <% end %>
      <div class="min-w-0 text-left">
        <%= link_to cart_item.product.generated_title, product_url, class: "sm:text-base text-gray-800 hover:text-primary-500 line-clamp-2", data: { turbo: false } %>
        <% if cart_item.configured? %>
          <div class="text-xs text-gray-600">
            Size: <%= cart_item.configuration["size"] %>
          </div>
          <div class="text-xs text-gray-500">
            Custom branded with your design
          </div>
        <% elsif cart_item.sample? %>
          <div class="text-xs text-gray-600">
            <%= cart_item.product.category&.name %>
          </div>
        <% else %>
          <div class="text-xs text-gray-600">
            <%= cart_item.product.category&.name %>
          </div>
        <% end %>
        <div class="text-gray-400 text-xs font-mono mt-1">
          SKU: <%= cart_item.product.sku %>
        </div>
      </div>
    </div>

    <%# Mobile: compact 3-column row for price/qty/total %>
    <div class="col-span-full grid grid-cols-3 gap-2 items-center md:hidden">
      <div class="text-left text-gray-700">
        <div class="text-xs text-gray-500">Price</div>
        <span id="cart_item_<%= cart_item.id %>_price_mobile">
          <% if cart_item.sample? %>
            <span class="font-medium">Free</span>
          <% else %>
            <%= format_price_display(cart_item) %>
          <% end %>
        </span>
      </div>

      <div class="text-center">
        <div class="text-xs text-gray-500 mb-1">Qty</div>
        <% if cart_item.sample? %>
          <span class="text-gray-600">1 unit</span>
        <% else %>
          <%= render "cart_items/quantity_selector", cart_item: cart_item, size: :xs %>
        <% end %>
      </div>

      <div class="text-right text-gray-700 flex items-center justify-end gap-3">
        <div>
          <div class="text-xs text-gray-500">Total</div>
          <span id="cart_item_<%= cart_item.id %>_total_mobile">
            <% if cart_item.sample? %>
              <span class="font-medium">Free</span>
            <% else %>
              <%= number_to_currency(cart_item.line_total) %>
            <% end %>
          </span>
        </div>
        <%= button_to cart_cart_item_path(cart_item), method: :delete, class: "btn btn-ghost btn-xs group", local: false, title: "Remove item", data: { turbo_confirm: "Remove this item from your cart?", turbo_confirm_button: "Remove" } do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-error/60 group-hover:text-error transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        <% end %>
      </div>
    </div>

    <%# Desktop: separate columns for price/qty/total/delete %>
    <div class="hidden md:block text-center text-gray-700">
      <span id="cart_item_<%= cart_item.id %>_price">
        <% if cart_item.sample? %>
          <span class="font-medium">Free</span>
        <% else %>
          <%= format_price_display(cart_item) %>
        <% end %>
      </span>
    </div>

    <div class="hidden md:block text-center">
      <% if cart_item.sample? %>
        <span class="text-gray-600">1 unit</span>
      <% else %>
        <%= render "cart_items/quantity_selector", cart_item: cart_item, size: :sm %>
      <% end %>
    </div>

    <div class="hidden md:block text-right text-gray-700">
      <span id="cart_item_<%= cart_item.id %>_total">
        <% if cart_item.sample? %>
          <span class="font-medium">Free</span>
        <% else %>
          <%= number_to_currency(cart_item.line_total) %>
        <% end %>
      </span>
    </div>

    <div class="hidden md:block text-center">
      <%= button_to cart_cart_item_path(cart_item), method: :delete, class: "btn btn-ghost btn-sm group", local: false, title: "Remove item", data: { turbo_confirm: "Remove this item from your cart?", turbo_confirm_button: "Remove" } do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-error/60 group-hover:text-error transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      <% end %>
    </div>
  </div>
<% end %>