<%= turbo_stream.update "cart" do %>
  <%= render partial: "cart_items/index", locals: { cart_items: Current.cart.cart_items.includes(:product).order('products.name ASC') } %>
<% end %>

<%= turbo_stream.replace "cart_counter" do %>
  <%= render partial: "shared/cart_counter", locals: { cart_items_count: Current.cart.items_count } %>
<% end %>

<%= turbo_stream.update "vat" do %>
  <%= number_to_currency(Current.cart.vat_amount) %>
<% end %>

<%= turbo_stream.update "subtotal" do %>
  <%= number_to_currency(Current.cart.subtotal_amount) %>
<% end %>

<%= turbo_stream.update "grand_total" do %>
  <%= number_to_currency(Current.cart.total_amount) %>
<% end %>

<%# Update discount savings if a discount is active %>
<% if session[:discount_code].present? && Current.cart.subtotal_amount.positive? %>
  <%= turbo_stream.update "discount_savings" do %>
    <%= number_to_currency(Current.cart.subtotal_amount * 0.05, unit: "Â£") %>
  <% end %>
<% end %>

<%# GA4 E-commerce: remove_from_cart event %>
<%= turbo_stream.append_all "head" do %>
  <script>
    <%= ecommerce_remove_from_cart_event_for_product(@product, quantity: @removed_quantity, value: @removed_value) %>
  </script>
<% end %>