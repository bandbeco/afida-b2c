<% content_for :title, "Frequently Asked Questions" %>
<% content_for :meta_description, "FAQs about Afida's eco-friendly packaging supplies. Find answers about products, shipping, returns, and ordering." %>

<div class="container mx-auto px-4 py-8 max-w-6xl">
  <!-- Header -->
  <div class="text-center mb-12">
    <h1 class="text-gray-900 mb-4">Frequently Asked Questions (FAQs)</h1>
    <p class="text-lg text-gray-600">Find answers to common questions about our packaging products and services</p>
  </div>

  <!-- Search Bar -->
  <div class="mb-8">
    <%= form_with url: faqs_path, method: :get, class: "max-w-2xl mx-auto", data: { controller: "faq-search", turbo_frame: "faq-content" } do |f| %>
      <div class="relative">
        <%= f.search_field :q,
            value: @search_query,
            placeholder: "Search FAQs...",
            class: "input input-bordered w-full pr-12",
            data: { faq_search_target: "input", action: "input->faq-search#search" } %>
        <button type="submit" class="btn btn-ghost btn-sm absolute right-2 top-1/2 -translate-y-1/2" aria-label="Search FAQs">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </button>
      </div>
    <% end %>
  </div>

  <!-- Two Column Layout -->
  <div class="flex flex-col md:flex-row gap-8">
    <!-- Sidebar: Quick Links (sticky on desktop) -->
    <aside class="md:w-1/4">
      <div class="md:sticky md:top-4">
        <nav class="p-6 bg-base-200 rounded-lg">
          <h2 class="text-gray-900 mb-4">Table of Contents</h2>
          <ul class="space-y-2">
            <% @categories.each do |category| %>
              <li>
                <a href="#<%= category["id"] %>" class="block py-2 px-3 rounded-lg hover:bg-primary hover:text-black transition-colors text-gray-700">
                  <%= category["title"] %>
                </a>
              </li>
            <% end %>
          </ul>
        </nav>

        <!-- Contact Info (sidebar) -->
        <div class="hidden md:block mt-6 p-6 bg-base-200 rounded-lg">
          <p class="text-gray-900 mb-2">Need help?</p>
          <p class="text-sm text-gray-600 mb-3">We're here to assist you</p>
          <a href="mailto:info@afida.com" class="block text-sm link mb-1">info@afida.com</a>
          <a href="tel:02033027719" class="block text-sm link">0203 302 7719</a>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="md:w-3/4" id="faq-content">
      <% if @search_results %>
        <!-- Search Results -->
        <div class="mb-8">
          <h2 class="text-gray-900 mb-4">
            Search Results for "<%= @search_query %>"
            <span class="text-sm text-gray-500">(<%= @search_results.size %> <%= "result".pluralize(@search_results.size) %>)</span>
          </h2>

          <% if @search_results.empty? %>
            <div class="alert alert-info">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>No results found. Try different keywords or browse categories below.</span>
            </div>
          <% else %>
            <div class="space-y-4">
              <% @search_results.each do |result| %>
                <div class="card bg-base-100 shadow-sm border border-base-300">
                  <div class="card-body">
                    <div class="badge badge-primary badge-sm mb-2"><%= result[:category_title] %></div>
                    <h3 class="card-title text-lg"><%= result[:question] %></h3>
                    <p class="text-gray-600"><%= render_faq_answer(result[:answer]) %></p>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>

          <div class="divider my-8">OR BROWSE ALL CATEGORIES</div>
        </div>
      <% end %>

      <!-- FAQ Questions by Category -->
      <% @categories.each do |category| %>
        <section class="mb-10 scroll-mt-4" id="<%= category["id"] %>">
          <h2 class="text-gray-900 mb-4"><%= category["title"] %></h2>

          <!-- Questions Accordion -->
          <div class="join join-vertical w-full">
            <% category["questions"].each do |q| %>
              <div class="collapse collapse-arrow join-item bg-base-100 border border-base-300">
                <input type="radio" name="faq-accordion-<%= category["id"] %>" aria-label="<%= q["question"] %>" />
                <div class="collapse-title text-lg" id="<%= category["id"] %>-<%= q["id"] %>">
                  <%= q["question"] %>
                </div>
                <div class="collapse-content">
                  <p class="text-gray-600 leading-relaxed pt-2"><%= render_faq_answer(q["answer"]) %></p>
                </div>
              </div>
            <% end %>
          </div>
        </section>
      <% end %>

      <!-- Contact CTA (mobile only, shown at bottom) -->
      <div class="md:hidden mt-12 text-center p-6 bg-base-200 rounded-lg">
        <p class="text-gray-900 mb-2">Still have questions?</p>
        <p class="text-gray-600">Contact us at <a href="mailto:info@afida.com" class="link">info@afida.com</a> or call <a href="tel:02033027719" class="link">0203 302 7719</a></p>
      </div>
    </main>
  </div>

  <!-- FAQ Schema Markup for SEO -->
  <%= faq_schema_markup(@categories) %>
</div>
