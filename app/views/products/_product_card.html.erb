<%# Product Card - displays a single product for the shop/category grid %>
<%# Local variables: product (required) %>

<div class="card bg-base-100 shadow-sm hover:shadow-md transition product-card h-full flex flex-col" data-product-id="<%= product.id %>">
  <%= link_to product_path(product), class: "flex flex-col flex-1", data: { turbo_frame: "_top" } do %>
    <figure class="aspect-square bg-white flex-shrink-0 overflow-hidden">
      <%= product_photo_tag(product.primary_photo,
                            alt: product.full_name,
                            class: "w-full h-full object-contain hover:scale-105 transition-transform duration-300",
                            variant: { resize_and_pad: [400, 400, { background: [255, 255, 255] }] },
                            loading: "lazy") %>
    </figure>

    <div class="card-body p-4 flex flex-col flex-1">
      <h3><%= product.full_name %></h3>

      <div class="flex-1"></div>

      <p class="text-sm text-gray-600 mt-auto">
        <%= number_to_currency(product.price, unit: "Â£") %> / pack
        <% if product.pac_size && product.pac_size > 1 %>
          <span class="text-xs text-gray-400">(<%= number_with_delimiter(product.pac_size) %> units)</span>
        <% end %>
      </p>
    </div>
  <% end %>

  <%# Quick Add directly to cart - single click since it's already a specific product %>
  <% if product.in_stock? %>
    <div class="card-actions p-4 pt-0">
      <%= form_with url: cart_cart_items_path, method: :post, data: { turbo_frame: "cart_drawer" }, class: "w-full" do |f| %>
        <%= f.hidden_field :product_id, value: product.id %>
        <%= f.hidden_field :quantity, value: 1 %>
        <%= f.submit "Add to Cart", class: "btn btn-secondary btn-sm w-full" %>
      <% end %>
    </div>
  <% else %>
    <div class="card-actions p-4 pt-0">
      <span class="btn btn-disabled btn-sm w-full">Out of Stock</span>
    </div>
  <% end %>
</div>
